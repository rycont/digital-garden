집에서 [[주간정리]] 쓴다. 10월 12일부터 15일까지 휴가이다.
- 🎵 아이브 리즈가 커버한 Love wins all https://youtu.be/14EVkqMkNEo
## yaksok.ts 업데이트
다음과 같은 부분이 변경되었다:
- 새롭게 작성한 파서 / 렉서로 일관성있는 동작
- Variable과 Keyword를 Identifier라는 노드로 통합
- 약속 정의 문법 수정
- 새롭게 추가된 연산자
- 웹 데모에 코드 공유 기능 추가
- 작은 따옴표로도 문자열을 작성할 수 있음
### 약속 정의 문법이 새로워졌습니다
기존에는 다음과 같이 약속을 정의했다.
```
약속 "키가" 키 "cm이고 몸무게가" 몸무게 "kg일 때 비만도"
	# ...

키가 170 cm이고 몸무게가 50 kg일 때 비만도
```
기존 문법은 가독성도 좋지 않았고, 무엇보다 다의적으로 해석이 가능한 경우가 있었어서 문제가 되었다. 예를 들어 다음과 같은 상황에서 모호성이 드러난다.
```
약속 "키" 키 "몸무게" 몸무게"의 비만도"
    # ...

키: 170
몸무게: 68
비만도: 키 키 몸무게 몸무게 의 비만도
```
함수를 호출할 때 인자와 함수 이름이 전혀 분리가 되지 않아서, 이를 올바르게 해석하기가 어려울 뿐 더러 여러 방법으로 해석하는 방법이 모두 맞는 경우도 있었다.
그래서 다음과 같이 개선하였다:
```
약속, 키 (키) 몸무게 (몸무게)의 비만도
    # ...

키: 170
몸무게: 68
비만도: 키 (키) 몸무게 (몸무게)의 비만도
```
1. 새 함수를 정의할 때 사용하는 "약속" 키워드의 뒤에 반점이 들어간다
2. 함수에서 고정되는 부분에 따옴표를 감싸지 않는다
3. 함수의 인수는 소괄호로 감싼다
4. 함수를 호출할 때도 인자를 소괄호로 감싼다

function variants와 함께 활용하면 다음과 같다
- 기존
```
약속 음식 "을/를" 사람 "와/과 먹기"
	# ...

"치킨"을 "형"과 먹기
```
- 개선
```
약속, (음식)을/를 (사람)와/과 먹기
	# ...

("치킨")을 ("형")과 먹기
```
### Identifier 노드
기존에는 다음과 같은 코드가 이렇게 토크나이징 되었었다

![token-before-refactor.png](./images/2024-w41/token-before-refactor.png)

굉장히 틀린 설계였다. 다른 언어에서 사용하는 통상적인 Keyword의 정의와도 상당히 다르며, 이 둘을 구분하면서 파서가 크게 복잡해지고 있었다.
어떠한 토큰이 변수인지 키워드인지 구분하기 위해 다음과 같은 규칙을 사용했다
1. 코드 전체에서 변수 정의 패턴을 찾아 코드 내에서 사용되는 모든 변수의 이름을 알아낸다
2. 변수 이름과 동일한 내용을 가지는 키워드는 변수로 해석한다
3. 그렇지 않으면 키워드로 해석한다
가장 큰 문제는 다음과 같은 코드였다.
```
약속, 키가 (키)cm이고 몸무게가 (몸무게)kg일 때 비만도
	... # 비만도를 계산하는 코드

비만도: 키가 (140)cm이고 몸무게가 (30)kg일 때 비만도
```
위 코드에서는 비만도라는 변수를 선언했기에, 내용이 "비만도"인 모든 토큰은 변수로 해석되었다. 함수 선언과 사용에 있는 "비만도"라는 텍스트는 변수가 아님이 명확하지만, 변수로 해석되었기에 코드가 올바르게 파싱되지 못했다.
키워드와 변수의 구분을 없애고 Identifier라는 하나의 노드로 파싱하면서, 잘못 파싱하는 경우를 줄이면서도 파서를 더 간결하게 만들 수 있었다. 더 적은 코드로 우아하고 유연하게 동작하는 파서를 만들었다.
이 작업을 하면서 렉서를 완전히 새롭게 재작성 했다.
### 웹 데모에서 코드를 직접 공유할 수 있다
https://yaksok-ts.pages.dev/#JUVDJTk1JUJEJUVDJTg2JThEJTJDJTIwJUVEJTgyJUE0JUVBJUIwJTgwJTIwKCVFRCU4MiVBNCljbSVFQyU5RCVCNCVFQSVCMyVBMCUyMCVFQiVBQSVCOCVFQiVBQyVCNCVFQSVCMiU4QyVFQSVCMCU4MCUyMCglRUIlQUElQjglRUIlQUMlQjQlRUElQjIlOEMpJUVDJTlEJUJDJTIwJUVCJTk1JThDJTIwJUVCJUI5JTg0JUVCJUE3JThDJUVCJThGJTg0JTBBJTIwJTIwJTIwJTIwJUVBJUIyJUIwJUVBJUIzJUJDJTNBJTIwJUVCJUFBJUI4JUVCJUFDJUI0JUVBJUIyJThDJTIwJTJGJTIwKCVFRCU4MiVBNCUyMCUyRiUyMDEwMCUyMColMjAlRUQlODIlQTQlMjAlMkYlMjAxMDApJTBBJTBBJUVCJUI5JTg0JUVCJUE3JThDJUVCJThGJTg0JTNBJTIwJUVEJTgyJUE0JUVBJUIwJTgwJTIwKDE3MCljbSVFQyU5RCVCNCVFQSVCMyVBMCUyMCVFQiVBQSVCOCVFQiVBQyVCNCVFQSVCMiU4QyVFQSVCMCU4MCUyMCg3MCklRUMlOUQlQkMlMjAlRUIlOTUlOEMlMjAlRUIlQjklODQlRUIlQTclOEMlRUIlOEYlODQlMEElRUIlQjklODQlRUIlQTclOEMlRUIlOEYlODQlMjAlRUIlQjMlQjQlRUMlOTclQUMlRUMlQTMlQkMlRUElQjglQjA=

이제 URL을 사용해서 코드를 공유할 수 있다. 안되는 코드가 있다면 공유하기 버튼을 눌러서 제게 바로 보내주세요.
### 그 외 추가 기능
- 연산자 종류 추가
	- or 연산자(논리합): 놀랍게도 yaksok.ts에서 or 연산자를 구현 안해두었었다. 이번에 새로 구현하였다. `이거나` 와 `거나`로 사용할 수 있다.
	- and 연산자(논리곱)의 Alias: 기존에 있던 `이고`에 더해 `고`로도 사용할 수 있다.
	- 정수 나눗셈 연산자(//): 나머지를 버리는 나눗셈을 구현한다
	- 나머지 연산자(%)
	- 제곱 연산자(\*\*)
- 작은 따옴표로 스트링 작성 가능
---
평양냉면..을 인생에서 두 번째 먹어봤다. 남대문 바로 앞에 있던 [[서령]]을 다녀왔다. 아직은 무슨 맛인지 모르겠다. 사골을 차갑게 식혀서 물타먹는 맛이다. [[을밀대]]보다 별로인 것 같기도 한데, 둘 다 맛있진 않았다. 다섯번쯤 먹어야 익숙해질 것 같다. 

---
[[성심당]] 대전역점에 [[N회차|또 갔다]]. 이번에는 [[소금빵]], [[보문산 메아리]]를 샀다. 이번 휴가는 보문산 메아리를 사러 나왔다고 해도 과언이 아니다. 보문산 메아리를 사기 위해서 일주일 전 부터 애타게 기다려왔고, 매일 밤 자기 전 보문산 메아리를 생각했는데, 대전역점에 갔는데 보문산 메아리는 없었고, 크게 실망할뻔 한 순간, 직원분께서 방금 나온 보문산 메아리를 진열해주셨다. 이 날 만큼은 행운아였다. 역시 맛있더라. 오늘부로 보문산 메아리는 내 최애가 되었다. 앞으로 휴가 나올 때 마다 N개씩 사올 예정이다.

---
그 외에는 한 일이 없다.